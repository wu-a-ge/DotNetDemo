(function(b){var a={init:function(d){var c=this;if(c.data("jqv")===undefined||c.data("jqv")==null){a._saveOptions(c,d);b(".formError").live("click",function(){b(this).fadeOut(150,function(){b(this).remove()})})}},attach:function(d){var c=this;var e;if(d){e=a._saveOptions(c,d)}else{e=c.data("jqv")}if(!e.binded){if(e.bindMethod=="bind"){if(e.isAttachFieldEvent){c.find("[class*=validate]").not("[type=checkbox]").bind(e.validationFieldEventTrigger,a._onFieldEvent);c.find("[class*=validate][type=checkbox]").bind("click",a._onFieldEvent)}if(e.isAttachFormEvent){c.bind("submit",a._onSubmitEvent)}}else{if(e.bindMethod=="live"){if(e.isAttachFieldEvent){c.find("[class*=validate]").not("[type=checkbox]").live(e.validationFieldEventTrigger,a._onFieldEvent);c.find("[class*=validate][type=checkbox]").live("click",a._onFieldEvent)}if(e.isAttachFormEvent){c.live("submit",a._onSubmitEvent)}}}e.binded=true}},detach:function(){var c=this;var d=c.data("jqv");if(d.binded){c.find("[class*=validate]").not("[type=checkbox]").unbind(d.validationEventTrigger,a._onFieldEvent);c.find("[class*=validate][type=checkbox]").unbind("click",a._onFieldEvent);c.unbind("submit",a._onSubmitEvent);c.find("[class*=validate]").not("[type=checkbox]").die(d.validationEventTrigger,a._onFieldEvent);c.find("[class*=validate][type=checkbox]").die("click",a._onFieldEvent);c.die("submit",a._onSubmitEvent);c.removeData("jqv")}},validate:function(c){var d=this.data("jqv");if(typeof(c)==="boolean"){d.isAjaxFieldValidation=c}return a._validateFields(this)},validateField:function(c,d){var e=b(c);if(e.get(0).disabled){return false}var f=b(this).data("jqv");if(typeof(d)==="boolean"){f.isAjaxFieldValidation=d}return !a._validateField(e,f)},validateform:function(){return a._onSubmitEvent(this)},showPrompt:function(f,d,c,h){var e=this.closest("form");var g=e.data("jqv");if(!g){g=a._saveOptions(this,g)}if(c){g.promptPosition=c}g.showArrow=h===true;a._showPrompt(this,f,d,false,g)},hidePrompt:function(){var c="."+b(this).attr("id").replace(":","_")+"formError";b(c).fadeTo("fast",0.3,function(){b(this).remove()})},hide:function(){if(b(this).is("form")){var c="parentForm"+b(this).attr("id")}else{var c=b(this).attr("id")+"formError"}b("."+c).fadeTo("fast",0.3,function(){b(this).remove()})},hideAll:function(){b(".formError").fadeTo("fast",0.3,function(){b(this).remove()})},_onFieldEvent:function(){var d=b(this);var c=d.closest("form");var e=c.data("jqv");a._validateField(d,e)},_onSubmitEvent:function(){var d=b(this);var c=a._validateFields(d,true);var e=d.data("jqv");if(c&&e.isAjaxFormValidation){a._validateFormWithAjax(d,e);return false}if(e.onValidationComplete){e.onValidationComplete(d,c);return false}return c},_checkAjaxStatus:function(d){var c=true;b.each(d.ajaxValidCache,function(f,e){if(e===false){c=false;return false}});return c},_validateFields:function(o,e){var f=o.data("jqv");var h=false;o.find("[class*=validate]").not(":hidden").not(":disabled").each(function(){var d=b(this);if(!d.hasClass("ajaxed")){h|=a._validateField(d,f,e)}});h|=!a._checkAjaxStatus(f);if(h){if(f.isScroll){var n=Number.MAX_VALUE;var l=b(".formError:not('.greenPopup')");for(var c=0;c<l.length;c++){var k=b(l[c]).offset().top;if(k<n){n=k}}if(!f.isOverflown){b("html:not(:animated),body:not(:animated)").animate({scrollTop:n},1100)}else{var g=b(f.overflownDIV);var j=g.scrollTop();var p=-parseInt(g.offset().top);n+=j+p-5;var m=b(f.overflownDIV+":not(:animated)");m.animate({scrollTop:n},1100)}}return false}return true},_validateFormWithAjax:function(c,d){var e=c.serialize();b.ajax({type:"post",url:c.attr("action"),cache:false,dataType:"json",data:e,form:c,methods:a,options:d,beforeSend:function(){return d.onBeforeAjaxFormValidation(c,d)},error:function(g,f){a._ajaxError(g,f)},success:function(m){if(m!==true){var g=false;for(var f=0;f<m.length;f++){var h=m[f];var j=h[0];var l=b(b("#"+j)[0]);if(l.length==1){var k=h[2];if(h[1]===true){if(k==""){a._closePrompt(l)}else{if(d.allrules[k]){var n=d.allrules[k].alertTextOk;if(n){k=n}}a._showPrompt(l,k,"pass",false,d)}}else{g|=true;if(d.allrules[k]){var n=d.allrules[k].alertText;if(n){k=n}}a._showPrompt(l,k,"",false,d)}}}d.onAjaxFormComplete(!g,c,m,d)}else{d.onAjaxFormComplete(true,c,"",d)}}})},_validateField:function(k,c,d){if(!k.attr("id")){b.error("jQueryValidate: an ID attribute is required for this field: "+k.attr("name")+" class:"+k.attr("class"))}var l=k.attr("class");var j=/validate\[(.*)\]/.exec(l);if(j===null){return false}var o=j[1];var h=o.split(/\[|,|\]/);var m=false;var g=k.attr("name");var q="";var e=false;c.isError=false;c.showArrow=true;optional=false;for(var n=0;n<h.length;n++){var p=undefined;switch(h[n]){case"optional":optional=true;break;case"required":e=true;p=a._required(k,h,n,c);break;case"custom":p=a._customRegex(k,h,n,c);break;case"ajax":if(!d&&c.isAjaxFieldValidation){a._ajax(k,h,n,c);m=true}break;case"minSize":p=a._minSize(k,h,n,c);break;case"maxSize":p=a._maxSize(k,h,n,c);break;case"min":p=a._min(k,h,n,c);break;case"max":p=a._max(k,h,n,c);break;case"past":p=a._past(k,h,n,c);break;case"future":p=a._future(k,h,n,c);break;case"maxCheckbox":p=a._maxCheckbox(k,h,n,c);k=b(b("input[name='"+g+"']"));break;case"minCheckbox":p=a._minCheckbox(k,h,n,c);k=b(b("input[name='"+g+"']"));break;case"equals":p=a._equals(k,h,n,c);break;case"funcCall":p=a._funcCall(k,h,n,c);break;default:}if(p!==undefined){q+=p+"<br/>";c.isError=true}if(c.isError){break}}if(!e&&!optional){if(b.trim(k.val())==""){c.isError=false}}var f=k.attr("type");if((f=="radio"||f=="checkbox")&&b("input[name='"+g+"']").size()>1){k=b(b("input[name='"+g+"'][type!=hidden]:first"));c.showArrow=false}if(!m){if(c.isError){a._showPrompt(k,q,"",false,c)}else{a._closePrompt(k)}}return c.isError},_required:function(g,f,e,h){var d=b.trim(g.val());switch(g.attr("type")){case"text":case"password":case"textarea":case"file":default:if(!d){return h.allrules[f[e]].alertText}break;case"radio":case"checkbox":var c=g.attr("name");if(b("input[name='"+c+"']:checked").size()===0){if(b("input[name='"+c+"']").size()===1){return h.allrules[f[e]].alertTextCheckboxe}else{return h.allrules[f[e]].alertTextCheckboxMultiple}}break;case"select-one":if(!d){return h.allrules[f[e]].alertTextSelect}break;case"select-multiple":if(!b.trim(g.find("option:selected").val())){return h.allrules[f[e]].alertTextSelect}break}},_customRegex:function(g,f,k,c){var e=f[k+1];var d=c.allrules[e];if(d===undefined){alert("jqv:�Զ������û���ҵ� "+e);return}var j=d.regex;if(j===undefined){alert("jqv:�Զ���������ʽû���ҵ� "+e);return}var h=new RegExp(j);if(!h.test(g.attr("value"))){return c.allrules[e].alertText}},_funcCall:function(g,f,e,h){var d=f[e+1];var c=window[d];if(typeof(c)==="function"){return c(g,f,e,h)}},_equals:function(f,e,d,g){var c=e[d+1];if(f.attr("value")!=b("#"+c).attr("value")){return g.allrules.equals.alertText}},_maxSize:function(g,e,d,h){var f=e[d+1];var c=g.attr("value").length;if(c>f){var j=h.allrules.maxSize;return j.alertText+f+j.alertText2}},_minSize:function(g,f,d,h){var e=f[d+1];var c=g.attr("value").length;if(c<e){var j=h.allrules.minSize;return j.alertText+e+j.alertText2}},_min:function(g,f,d,h){var e=parseFloat(f[d+1]);var c=parseFloat(g.attr("value"));if(c<e){var j=h.allrules.min;if(j.alertText2){return j.alertText+e+j.alertText2}return j.alertText+e}},_max:function(g,e,d,h){var f=parseFloat(e[d+1]);var c=parseFloat(g.attr("value"));if(c>f){var j=h.allrules.max;if(j.alertText2){return j.alertText+f+j.alertText2}return j.alertText+f}},_past:function(g,f,j,c){var h=f[j+1];var e=(h.toLowerCase()=="now")?new Date():a._parseDate(h);var k=a._parseDate(g.attr("value"));if(k>e){var d=c.allrules.past;if(d.alertText2){return d.alertText+a._dateToString(e)+d.alertText2}return d.alertText+a._dateToString(e)}},_future:function(g,f,j,c){var h=f[j+1];var e=(h.toLowerCase()=="now")?new Date():a._parseDate(h);var k=a._parseDate(g.attr("value"));if(k<e){var d=c.allrules.future;if(d.alertText2){return d.alertText+a._dateToString(e)+d.alertText2}return d.alertText+a._dateToString(e)}},_maxCheckbox:function(g,f,d,h){var j=f[d+1];var c=g.attr("name");var e=b("input[name='"+c+"']:checked").size();if(e>j){h.showArrow=false;return h.allrules.maxCheckbox.alertText}},_minCheckbox:function(g,f,d,h){var j=f[d+1];var c=g.attr("name");var e=b("input[name='"+c+"']:checked").size();if(e<j){h.showArrow=false;return h.allrules.minCheckbox.alertText+" "+j+" "+h.allrules.minCheckbox.alertText2}},_ajax:function(j,h,l,c){var m=h[l+1];var e=c[m];var k=e.extraData;var f=e.fieldName?e.fieldName:"fieldValue";var g;if(!e.isJson){if(!k){k=""}else{if(typeof(k)==="object"){k="&"+b.param(k)}else{if(typeof(k)==="string"){k="&"+k}}}g=f+"="+b.trim(j.val())+k}else{if(typeof(k)==="object"){var d=b.extend({},{fieldName:b.trim(j.val())},k);g=JSON.stringify(d)}else{b.error("extraData ������JSON����")}}if(!c.isError){b.ajax({async:false,type:e.type===undefined?"get":e.type,url:e.url,cache:false,contentType:"application/json",dataType:"json",data:g,field:j,options:c,beforeSend:function(){var i=e.alertTextLoad;if(i){a._showPrompt(j,i,"load",true,c)}},error:function(n,i){a._ajaxError(n,i)},success:function(n){var o=(n.d===undefined?n.status:n.d.status);errorFieldId=j.attr("id");if(o===false){c.ajaxValidCache[errorFieldId]=false;c.isError=true;var p=e.alertText;a._showPrompt(j,p,"",true,c)}else{if(c.ajaxValidCache[errorFieldId]!==undefined){c.ajaxValidCache[errorFieldId]=true}var i=e.alertTextOk;if(i){a._showPrompt(j,i,"pass",true,c)}else{a._closePrompt(j)}}}})}},_ajaxError:function(d,c){if(d.status===0&&c===null){alert("The page is not served from a server! ajax call failed")}else{if(console){console.log("Ajax error: "+d.status+" "+c)}}},_dateToString:function(c){return c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()},_parseDate:function(c){var e=c.split("-");if(e!==c){e=c.split("/")}return new Date(e[0],(e[1]-1),e[2])},_showPrompt:function(f,d,e,h,g){var c=a._getPrompt(f);if(c){a._updatePrompt(f,c,d,e,h,g)}else{a._buildPrompt(f,d,e,h,g)}},_buildPrompt:function(g,k,f,d,c){var j=b("<div>");j.addClass(g.attr("id").replace(":","_")+"formError");if(g.is(":input")){j.addClass("parentForm"+g.parents("form").attr("id").replace(":","_"))}j.addClass("formError");switch(f){case"pass":j.addClass("greenPopup");break;case"load":j.addClass("blackPopup")}if(d){j.addClass("ajaxed")}var e=b("<div>").addClass("formErrorContent").html(k).appendTo(j);if(c.showArrow){var i=b("<div>").addClass("formErrorArrow");switch(c.promptPosition){case"bottomLeft":case"bottomRight":j.find(".formErrorContent").before(i);i.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":i.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');j.append(i);break}}if(c.isOverflown){g.before(j)}else{b("body").append(j)}var h=a._calculatePosition(g,j,c);j.css({top:h.callerTopPosition,left:h.callerleftPosition,marginTop:h.marginTopSize,opacity:0});return j.animate({opacity:0.87})},_updatePrompt:function(g,i,d,f,e,h){if(i){if(f=="pass"){i.addClass("greenPopup")}else{i.removeClass("greenPopup")}if(f=="load"){i.addClass("blackPopup")}else{i.removeClass("blackPopup")}if(e){i.addClass("ajaxed")}else{i.removeClass("ajaxed")}i.find(".formErrorContent").html(d);var c=a._calculatePosition(g,i,h);i.animate({top:c.callerTopPosition,marginTop:c.marginTopSize})}},_closePrompt:function(c){var d=a._getPrompt(c);if(d){d.fadeTo("fast",0,function(){d.remove()})}},closePrompt:function(c){return a._closePrompt(c)},_getPrompt:function(e){var d="."+e.attr("id").replace(":","_")+"formError";var c=b(d)[0];if(c){return b(c)}},_calculatePosition:function(g,j,c){var f,h,d;var k=g.width();var i=j.height();var e=c.isOverflown;if(e){f=h=0;d=-i}else{var l=g.offset();f=l.top;h=l.left;d=0}switch(c.promptPosition){default:case"topRight":if(e){h+=k-30}else{h+=k-30;f+=-i}break;case"topLeft":f+=-i-10;break;case"centerRight":h+=k+13;break;case"bottomLeft":f=f+g.height()+15;break;case"bottomRight":h+=k-30;f+=g.height()+5}return{callerTopPosition:f+"px",callerleftPosition:h+"px",marginTopSize:d+"px"}},_saveOptions:function(d,e){if(b.validationEngineLanguage){var f=b.validationEngineLanguage.allRules}else{b.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page")}var c=b.extend({validationFieldEventTrigger:"blur",isScroll:true,promptPosition:"topRight",bindMethod:"bind",isAjaxFormValidation:false,isAjaxFieldValidation:false,isAttachFieldEvent:true,isAttachFormEvent:true,onAjaxFormComplete:b.noop,onBeforeAjaxFormValidation:b.noop,onValidationComplete:false,isOverflown:false,overflownDIV:"",allrules:f,binded:false,showArrow:true,isError:false,ajaxValidCache:{}},e);d.data("jqv",c);return c}};b.fn.validationEngine=function(c){var d=b(this);if(!d[0]){return false}if(typeof(c)==="string"&&c.charAt(0)!="_"&&a[c]){if(c!="showPrompt"&&c!="hidePrompt"&&c!="hide"&&c!="hideAll"){a.init.apply(d)}return a[c].apply(d,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){a.init.apply(d,arguments);return a.attach.apply(d)}else{b.error("Method "+c+" does not exist in jQuery.validationEngine")}}}})(jQuery);